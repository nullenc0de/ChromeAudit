id: use-content-scripts-carefully

info:
  name: Validate Content Script Inputs
  description: Content scripts should validate, sanitize, and restrict inputs before usage to prevent XSS and API abuse.
  author: nullenc0de
  severity: medium

file:
  - extensions:
      - js

    matchers:
      - type: regex
        regex:
          - "chrome\.runtime\.onMessage\.addListener"

      - type: regex  
        regex:
          - "if\\(sender\.tab\\\.url\\\.match"
        negative: true
          
      - type: regex
        regex: 
          - "\\.sanitize\\(" 
        negative: true

      - type: regex
        regex:
          - "\\.validateInput\\("
        negative: true

    extractors:
      - type: regex
        part: body  
        name: runtime_listeners
        regex:
          - "chrome\\.runtime\\.onMessage(?:External)?\\s*\\.addListener\\([^{}]+\\{[^}]+\\}"
  
      - type: regex
        part: runtime_listeners
        name: dangerous_apis
        regex:
          - "\\.([^(]+)\\("
